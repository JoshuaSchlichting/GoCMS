{{ define "clickable_table" }}
<div>
    <table id="{{ .ClickableTable.TableID }}" class="table table-hover">
        {{ range $i, $row := .ClickableTable.Table }}
        <thead>
            {{ if eq $i 0 }}
            <tr>
                {{ range $key, $val := $row }}
                <th scope="col">{{ $key }}</th>
                {{ end }}
            </tr>
            {{ end }}
        </thead>
        <tbody>
            <tr>
                {{ range $key, $val := $row }}
                <td>{{ $val }}</td>
                {{ end }}
            </tr>
        </tbody>
        {{ end }}
    </table>
    <script>
        {{ .ClickableTable.JavaScript }}
    </script>
    <script type="text/javascript">
        var {{ .ClickableTable.TableID }}SelectedRow = null;
        function handleRowClick(table, url, callback = null) {
            const rows = table.getElementsByTagName("tr");
            for (let i = 0; i < rows.length; i++) {
                rows[i].addEventListener("click", function () {
                    const cols = this.getElementsByTagName("td");
                    const payload = {};
                    for (let j = 0; j < cols.length; j++) {
                        const key = table.getElementsByTagName("th")[j].innerHTML;
                        const val = cols[j].innerHTML;
                        payload[key] = val;
                    }
                    const apiEndpoint = "/user/" + payload["ID"];
                    { { .ClickableTable.TableID } } SelectedRow = payload["ID"];
                    console.log("Selected row: " + {{ .ClickableTable.TableID }}SelectedRow);
                if (callback != null) {
                    callback();
                }

            });
        }
        }
        handleRowClick(document.getElementById("{{ .ClickableTable.TableID }}"), "{{ .ClickableTable.PostURL }}", {{ .ClickableTable.CallbackFunc }});
    </script>
</div>
{{ end }}